<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns="http://www.w3.org/1999/html">
<head>
    <meta name="description" content="Settings for DB for ESP32">
    <meta name="author" content="Wolfgang Christl">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configuration Settings</title>
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="./auxlog(32_32) (1).jpg">
	<link rel="icon" type="image/png" sizes="16x16" href="./auxlog(16_16) (1).jpg">
    <meta name="theme-color" content="#3166FF">
    <link inline href="skeleton.css" />
    <link inline href="toastify/toastify.css" />
    <link inline href="dronebridge.css" />
    <script inline src="toastify/toastify.js"></script>
    <script inline src="dronebridge.js"></script>
</head>
<style>
        /*
        * Skeleton V2.0.4
        * Copyright 2014, Dave Gamache
        * www.getskeleton.com
        * Free to use under the MIT license.
        * http://www.opensource.org/licenses/mit-license.php
        * 12/29/2014
        */
        .column,.columns,.container{width:100%;box-sizing:border-box}h1,h2,h3{letter-spacing:-.1rem}body,h6{line-height:1.6}ol,p,ul{margin-top:0}.container{position:relative;max-width:800px;margin:0 auto;padding:0 20px}.column,.columns{float:left}@media (min-width:400px){.container{width:85%;padding:0}}html{font-size:62.5%}body{font-size:1.5em;font-weight:400;font-family:Raleway,HelveticaNeue,"Helvetica Neue",Helvetica,Arial,sans-serif;color:#222}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:2rem;font-weight:300}h1{font-size:4rem;line-height:1.2}h2{font-size:3.6rem;line-height:1.25}h3{font-size:3rem;line-height:1.3}h4{font-size:2.4rem;line-height:1.35;letter-spacing:-.08rem}h5{font-size:1.8rem;line-height:1.5;letter-spacing:-.05rem}h6{font-size:1.5rem;letter-spacing:0}@media (min-width:550px){.container{width:80%}.column,.columns{margin-left:4%}.column:first-child,.columns:first-child{margin-left:0}.one.column,.one.columns{width:4.66666666667%}.two.columns{width:13.3333333333%}.three.columns{width:22%}.four.columns,.one-third.column{width:30.6666666667%}.five.columns{width:39.3333333333%}.one-half.column,.six.columns{width:48%}.seven.columns{width:56.6666666667%}.eight.columns,.two-thirds.column{width:65.3333333333%}.nine.columns{width:74%}.ten.columns{width:82.6666666667%}.eleven.columns{width:91.3333333333%}.twelve.columns{width:100%;margin-left:0}.offset-by-one.column,.offset-by-one.columns{margin-left:8.66666666667%}.offset-by-two.column,.offset-by-two.columns{margin-left:17.3333333333%}.offset-by-three.column,.offset-by-three.columns{margin-left:26%}.offset-by-four.column,.offset-by-four.columns,.offset-by-one-third.column,.offset-by-one-third.columns{margin-left:34.6666666667%}.offset-by-five.column,.offset-by-five.columns{margin-left:43.3333333333%}.offset-by-one-half.column,.offset-by-one-half.columns,.offset-by-six.column,.offset-by-six.columns{margin-left:52%}.offset-by-seven.column,.offset-by-seven.columns{margin-left:60.6666666667%}.offset-by-eight.column,.offset-by-eight.columns,.offset-by-two-thirds.column,.offset-by-two-thirds.columns{margin-left:69.3333333333%}.offset-by-nine.column,.offset-by-nine.columns{margin-left:78%}.offset-by-ten.column,.offset-by-ten.columns{margin-left:86.6666666667%}.offset-by-eleven.column,.offset-by-eleven.columns{margin-left:95.3333333333%}h1{font-size:5rem}h2{font-size:4.2rem}h3{font-size:3.6rem}h4{font-size:3rem}h5{font-size:2.4rem}h6{font-size:1.5rem}}a{color:#1eaedb}a:hover{color:#0fa0ce}.button,button,input[type=button],input[type=reset],input[type=submit]{display:inline-block;height:38px;padding:0 30px;color:#555;text-align:center;font-size:11px;font-weight:600;line-height:38px;letter-spacing:.1rem;text-transform:uppercase;text-decoration:none;white-space:nowrap;background-color:transparent;border-radius:4px;border:1px solid #bbb;cursor:pointer;box-sizing:border-box}ol,td:first-child,th:first-child,ul{padding-left:0}.button:focus,.button:hover,button:focus,button:hover,input[type=button]:focus,input[type=button]:hover,input[type=reset]:focus,input[type=reset]:hover,input[type=submit]:focus,input[type=submit]:hover{color:#333;border-color:#888;outline:0}.button.button-primary,button.button-primary,input[type=button].button-primary,input[type=reset].button-primary,input[type=submit].button-primary{color:#fff;background-color:#33c3f0;border-color:#33c3f0}.button.button-primary:focus,.button.button-primary:hover,button.button-primary:focus,button.button-primary:hover,input[type=button].button-primary:focus,input[type=button].button-primary:hover,input[type=reset].button-primary:focus,input[type=reset].button-primary:hover,input[type=submit].button-primary:focus,input[type=submit].button-primary:hover{color:#fff;background-color:#1eaedb;border-color:#1eaedb}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],select,textarea{height:38px;padding:6px 10px;background-color:#fff;border:1px solid #d1d1d1;border-radius:4px;box-shadow:none;box-sizing:border-box}input[type=email],input[type=number],input[type=password],input[type=search],input[type=tel],input[type=text],input[type=url],textarea{-webkit-appearance:none;-moz-appearance:none;appearance:none}textarea{min-height:65px;padding-top:6px;padding-bottom:6px}input[type=email]:focus,input[type=number]:focus,input[type=password]:focus,input[type=search]:focus,input[type=tel]:focus,input[type=text]:focus,input[type=url]:focus,select:focus,textarea:focus{border:1px solid #33c3f0;outline:0}label,legend{display:block;margin-bottom:.5rem;font-weight:600}fieldset{padding:0;border-width:0}input[type=checkbox],input[type=radio]{display:inline}label>.label-body{display:inline-block;margin-left:.5rem;font-weight:400}ul{list-style:circle inside}ol{list-style:decimal inside}ol ol,ol ul,ul ol,ul ul{margin:1.5rem 0 1.5rem 3rem;font-size:90%}.button,button,li{margin-bottom:1rem}code{padding:.2rem .5rem;margin:0 .2rem;font-size:90%;white-space:nowrap;background:#f1f1f1;border:1px solid #e1e1e1;border-radius:4px}pre>code{display:block;padding:1rem 1.5rem;white-space:pre}td,th{padding:12px 15px;text-align:left;border-bottom:1px solid #e1e1e1}td:last-child,th:last-child{padding-right:0}fieldset,input,select,textarea{margin-bottom:1.5rem}blockquote,dl,figure,form,ol,p,pre,table,ul{margin-bottom:2.5rem}hr{margin-top:3rem;margin-bottom:3.5rem;border-width:0;border-top:1px solid #e1e1e1}.container:after,.row:after,.u-cf{content:"";display:table;clear:both}
    </style>
    <style>
        /*!
         * Toastify js 1.12.0
         * https://github.com/apvarun/toastify-js
         * @license MIT licensed
         *
         * Copyright (C) 2018 Varun A P
         */
        .toast-close,.toastify{color:#fff;cursor:pointer}.toastify{padding:12px 20px;display:inline-block;box-shadow:0 3px 6px -1px rgba(0,0,0,.12),0 10px 36px -4px rgba(77,96,232,.3);background:-webkit-linear-gradient(315deg,#73a5ff,#5477f5);background:linear-gradient(135deg,#73a5ff,#5477f5);position:fixed;opacity:0;transition:.4s cubic-bezier(.215, .61, .355, 1);border-radius:2px;text-decoration:none;max-width:calc(50% - 20px);z-index:2147483647}.toastify.on{opacity:1}.toast-close{background:0 0;border:0;font-family:inherit;font-size:1em;opacity:.4;padding:0 5px}.toastify-right{right:15px}.toastify-left{left:15px}.toastify-top{top:-150px}.toastify-bottom{bottom:-150px}.toastify-rounded{border-radius:25px}.toastify-avatar{width:1.5em;height:1.5em;margin:-7px 5px;border-radius:2px}.toastify-center{margin-left:auto;margin-right:auto;left:0;right:0;max-width:fit-content;}@media only screen and (max-width:360px){.toastify-left,.toastify-right{margin-left:auto;margin-right:auto;left:0;right:0;max-width:fit-content}}
    </style>
    <style>
      label{font-weight:normal;font-size:small}form,h3{margin-bottom:.5rem}.dot_green,.dot_red{height:.8rem;width:.8rem;border-radius:50%;display:inline-block}html{min-height:100%}body{height:100%;margin:0;color:#fff;background:#eeeeee;background:linear-gradient(180deg,#0f0f0f 0,#313131 100%)}h2{font-size:x-large;padding-top:2rem;margin-bottom:.8rem}h3{font-family:Arial,sans-serif;font-size:large}button.button-primary{background-color:#ff881a;border-color:grey}button.button-primary:hover{background-color:#003166;color:#ff881a;border-color:#ff881a}button.button-primary:focus{background-color:#003166;color:#9a4e0b;border-color:#9a4e0b}input,select{color:#000}.dot_green{background-color:#68b838}.dot_red{background-color:#f63e3e}
    </style>
<body>
<div class="container">
    <br>
    <div class="twelve columns">
        <img src="./auxobitlogo.png" alt="DB Logo">
    </div>
</div>
<div class="container">
    <form id="settings_form">
        <div>
            <h2>Statistics</h2>
            <div class="row">
                <div id="web_conn_status" class="six columns small_text">
                </div>
            </div>
            <div class="row">
                <div id="current_client_ip" class="twelve columns small_text">
                </div>
            </div>
            <div class="row">
                <div class="four columns">
                    <label>received bytes serial port</label>
                    <div id="read_bytes">-</div>
                </div>
                <div class="four columns">
                    <label>Connected TCP clients</label>
                    <div id="tcp_connected">-</div>
                </div>
                <div class="four columns">
                    <label>Connected UDP clients</label>
                    <div style="display: flex" >
                        <div id="udp_connected" class="tooltip" style="width: fit-content"><span class="tooltiptext" id="tooltip_udp_clients">-</span>-</div>
                        <img class="img_button" style="margin-left: 5rem; padding: 0.2rem" height="20em" alt="add" src="add_16dp_icon.png" onclick="add_new_udp_client()"/>
                        <img class="img_button" style="margin-left: 0.5rem; padding: 0.2rem" height="20em" alt="delete" src="remove_16dp_icon.png" onclick="clear_udp_clients()"/>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <h2>Settings</h2>
            <h3>Wi-Fi</h3>
            <div class="row">
                <div class="twelve columns">
                    <label for="esp32_mode">Modes</label>
                    <select id="esp32_mode" name="esp32_mode" form="settings_form" onchange="change_ap_ip_visibility()">
                        <option value="1">Wi-Fi Access Point Mode</option>
                        <option value="2">Wi-Fi Client Mode</option>
                        <option value="3">Wi-Fi Access Point LR Mode</option>
                        <option value="4">ESP-NOW LR Mode AIR</option>
                        <option value="5">ESP-NOW LR Mode GND</option>
                        <option value="6">Bluetooth LE</option>
                    </select>
                    <div class="note" id="esp-lr-ap-disclaimer"><h4>Attention:</h4>
                        LR Mode makes the device invisible for non-LR enabled devices!<br>You will not be able to change the config!<br><br>
                        The data rate is reduced to ~0.25Mbps. The range may be increase by a factor of ~2.<br>Press the boot
                        button (short press for AP-Mode with password "hellfire@123" or long press for reset to defaults)
                        or erase the flash memory of the ESP32 and re-flash hellfire firmware to get back into
                        normal Wi-Fi Mode!
                    </div>
                    <div class="note" id="ble_disclaimer_div"><h4>Attention:</h4>
                        <b>BETA: Bluetooth LE (BLE) is currently in beta testing.</b><br>
                        The application (e.g. GCS software) must explicitly support Hellfire BLE connections.<br>
                        At the moment only the recent Betaflight Configurator supports BLE connections but does so very poorly.<br>
                        Check the Hellfire BLE Bridge to connect QGC or MissionPlanner to your ESP32 running hellfire BLE<br>
                        There is no support for Bluetooth Classic (SPP) by hellfire for esp.<br>
                        Your Wi-Fi Access Point Mode configuration will be used to host an AP in parallel so you can still access this configuration page.
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="six columns" id="wifi_ssid_div">
                    <label for="ssid">SSID</label>
                    <input type="text" name="ssid" value="" id="ssid" maxlength="31">
                </div>
                <div class="six columns" id="pass_div">
                    <label for="wifi_pass">Password</label>
                    <input type="text" name="wifi_pass" value="" id="wifi_pass" minlength="8" maxlength="63" required>
                </div>
            </div>
            <div class="row">
                <div id="ap_channel_div" class="six columns">
                    <label for="wifi_chan">Channel</label>
                    <select id="wifi_chan" name="wifi_chan" form="settings_form">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                    </select>
                </div>
                <div class="six columns" id="ap_ip_div">
                    <label for="ap_ip">Gateway IP address</label>
                    <input type="text" name="ap_ip" value="" id="ap_ip">
                </div>
            </div>
            <div id="wifi_en_gn_div" class="row">
                <div class="twelve columns">
                    <div class="checkbox-wrapper-14">
                        <input id="wifi_en_gn" name="wifi_en_gn" type="checkbox" class="switch">
                        <label class="tooltip" for="wifi_en_gn"><span class="tooltiptext">Only enable this when you need b/g/n/ax support. When off there is only 802.11b support in Wi-Fi client mode which provides sufficient bandwidth and is ideal for range. 802.11ax only on supported chips.</span>802.11b/g/n/ax support</label>
                    </div>
                </div>
            </div>
            <div id="radio_dis_onarm_div" class="row">
                <div class="twelve columns">
                    <div class="checkbox-wrapper-14">
                        <input id="radio_dis_onarm" name="radio_dis_onarm" type="checkbox" class="switch">
                        <label for="radio_dis_onarm">Disable radio when autopilot is armed</label>
                    </div>
                </div>
            </div>
            <div id="ant_use_ext_div" class="row">
                <div class="twelve columns">
                    <div class="checkbox-wrapper-14">
                        <input id="ant_use_ext" name="ant_use_ext" type="checkbox" class="switch">
                        <label for="ant_use_ext">Use external antenna</label>
                    </div>
                </div>
            </div>
            <div id="static_ip_config_div">
                <details>
                    <summary>Advanced Wi-Fi Settings</summary>
                    <div class="row">
                        <div class="six columns" id="ip_sta_div">
                            <label for="ip_sta">Static IP Address</label>
                            <input type="text" name="ip_sta" value="" id="ip_sta" maxlength="15" placeholder="optional - can be empty">
                        </div>
                        <div class="six columns" id="ip_sta_gw_div">
                            <label for="ip_sta_gw">Static IP Gateway Address</label>
                            <input type="text" name="ip_sta_gw" value="" id="ip_sta_gw" maxlength="15" placeholder="optional - can be empty">
                        </div>
                    </div>
                    <div class="row">
                        <div class="six columns" id="ip_sta_netmsk_div">
                            <label for="ip_sta_netmsk">Static IP Netmask</label>
                            <input type="text" name="ip_sta_netmsk" value="" id="ip_sta_netmsk" maxlength="15" placeholder="optional - can be empty">
                        </div>
                        <div class="six columns" id="wifi_hostname_div">
                            <label for="wifi_hostname">Hostname</label>
                            <input type="text" name="wifi_hostname" value="" maxlength="31" id="wifi_hostname" placeholder="Hellfire_esp">
                        </div>
                    </div>
                </details>
            </div>
            <h3 style="margin-top: 2rem">Serial</h3>
            <div class="row" id="tx_rx_div">
                <div class="six columns">
                    <label for="gpio_tx">UART TX GPIO</label>
                    <input type="number" name="gpio_tx" value="" id="gpio_tx">
                </div>
                <div class="six columns">
                    <label for="gpio_rx">UART RX GPIO</label>
                    <input type="number" name="gpio_rx" value="" id="gpio_rx">
                </div>
            </div>
            <div class="row" id="rts_cts_div">
                <div class="six columns">
                    <label for="gpio_rts">UART RTS GPIO</label>
                    <input type="number" name="gpio_rts" value="" id="gpio_rts" onchange="flow_control_check()">
                </div>
                <div class="six columns">
                    <label for="gpio_cts">UART CTS GPIO</label>
                    <input type="number" name="gpio_cts" value="" id="gpio_cts" onchange="flow_control_check()">
                </div>
            </div>
            <div class="row" id="rts_thresh_div">
                <div class="six columns">
                    <label for="rts_thresh">UART RTS threshold</label>
                    <input type="number" id="rts_thresh" name="rts_thresh" min="1" max="128">
                </div>
            </div>
            <div class="row">
                <div class="six columns">
                    <label for="proto">UART serial protocol</label>
                    <select id="proto" name="proto" form="settings_form"
                            onchange="change_msp_ltm_visibility()">
                        <option value="1">MSP/LTM</option>
                        <option value="4">MAVLink</option>
                        <option value="5">Transparent</option>
                    </select>
                </div>
                <div class="six columns" id="baud_div">
                    <label for="baud">UART baud</label>
                    <select name="baud" id="baud" form="settings_form">
                        <option value="5000000">5000000</option>
                        <option value="1500000">3000000</option>
                        <option value="1500000">2000000</option>
                        <option value="1500000">1500000</option>
                        <option value="1000000">1000000</option>
                        <option value="500000">500000</option>
                        <option value="921600">921600</option>
                        <option value="576000">576000</option>
                        <option value="460800">500800</option>
                        <option value="460800">460800</option>
                        <option value="230400">230400</option>
                        <option value="115200">115200</option>
                        <option value="76800">76800</option>
                        <option value="57600">57600</option>
                        <option value="38400">38400</option>
                        <option value="19200">19200</option>
                        <option value="9600">9600</option>
                        <option value="4800">4800</option>
                        <option value="2400">2400</option>
                        <option value="1200">1200</option>
                    </select>
                </div>
            </div>
            <div id="msp_ltm_div" class="row">
                <div class="twelve columns">
                    <label for="ltm_per_packet">LTM frames per packet</label>
                    <select id="ltm_per_packet" name="ltm_per_packet" form="settings_form">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </div>
            <div id="trans_pack_size_div" class="row">
                <div class="six columns">
                    <label for="trans_pack_size">Maximum packet size</label>
                    <select id="trans_pack_size" name="trans_pack_size" form="settings_form">
                        <option value="16">16</option>
                        <option value="32">32</option>
                        <option value="64">64</option>
                        <option value="128">128</option>
                        <option value="256">256</option>
                        <option value="512">512</option>
                        <option value="768">768</option>
                    </select>
                </div>
                <div class="six columns">
                    <label for="serial_timeout">Serial read timeout [ms]</label>
                    <input type="number" id="serial_timeout" name="serial_timeout" min="1" max="65535" value="50">
                </div>
            </div>
            <div id="rep_rssi_dbm_div" class="row">
                <div class="twelve columns">
                    <div class="checkbox-wrapper-14">
                        <input id="rep_rssi_dbm" name="rep_rssi_dbm" type="checkbox" class="switch">
                        <label for="rep_rssi_dbm">Report Rssi in [dBm] instead of 0-100</label>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="row">
        <div class="six columns">
            <button class="button-primary" onclick="save_settings()">Save Settings & Reboot</button>
        </div>
    </div>
</div>
<div class="container">
    <div id="esp_mac" style="margin-top: 1rem" class="row small_text"></div>
    <div id="about" style="margin-bottom: 1rem" class="row">Hellfire is waiting for a response ...
    </div>
</div>
<script>
    // get settings once upon page load
    while (get_system_info() < 0) {
    }
    while (get_settings() < 0) {
    }
    // get stats every half a second
    setInterval(get_stats, 500)
    setInterval(update_conn_status, 500)
    setTimeout(change_msp_ltm_visibility, 500)
    setTimeout(change_ap_ip_visibility, 500)
    setTimeout(change_uart_visibility, 500)
</script>
</body>
</html>
